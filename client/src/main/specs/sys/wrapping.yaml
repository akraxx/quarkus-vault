name: Wrapping
category: sys
mountable: false
basePath: sys

operations:

- name: lookup
  method: POST
  path: wrapping/lookup
  bodyFrom: [token]
  parameters:
  - name: token
    type: String
  result:
    kind: leased
    unwrapsData: true
    data:
    - name: creationPath
      type: String
    - name: creationTime
      type: java.time.OffsetDateTime
    - name: creationTtl
      type: Long


- name: rewrap
  method: POST
  path: wrapping/rewrap
  bodyFrom: [token]
  parameters:
  - name: token
    type: String
  result:
    kind: leased
    unwrapUsing: r.wrapInfo
    unwrappedType: $$.api.common.VaultWrapInfo
    dataType: Void
    authType: Void


- name: unwrap
  method: POST
  path: wrapping/unwrap
  result:
    kind: leased
    dataType: java.util.Map<String, Object>


- name: unwrap
  method: POST
  path: wrapping/unwrap
  bodyFrom: [token]
  parameters:
  - name: token
    type: String
  result:
    kind: leased
    dataType: java.util.Map<String, Object>


- name: wrap
  method: POST
  path: wrapping/wrap
  bodyFrom: [data]
  wrapTTLFrom: wrapTtl
  parameters:
  - name: data
    type: java.util.Map<String, Object>
  - name: wrapTtl
    type: java.time.Duration
  result:
    kind: leased
    unwrapUsing: r.wrapInfo
    unwrappedType: $$.api.common.VaultWrapInfo
    dataType: Void
    authType: Void


methods:
- name: unwrapAs
  typeParameters: [T]
  returnType: Uni<T>
  parameters:
    token: String
    type: Class<T>
  body: |
    return unwrap(token).map(r -> {
      var val = r.auth != null ? r.auth : r.data; 
      return $T.convert(val, type);
    });
  bodyArguments:
  - <type>io.quarkus.vault.client.util.JsonMapping
